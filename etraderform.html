<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>
			Imperial Asset Managers Limited – We are Imperial….Proudly Imperial
		</title>
		<link rel="stylesheet" href="style.css" />
		<link
			rel="stylesheet"
			href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
		/>
	</head>
	<body>
		<div class="overlay" id="overlay"></div>

		<!-- Popup -->
		<div class="popup" id="popup">
			<div class="popup-content">
				<div class="popuptop">
					To access this research, kindly create an account.
					<div class="close-bt" onclick="closePopup()">x</div>
				</div>
				<div class="myform">
					<div class="formtitle">Create an Account</div>
					<input type="text" placeholder="First Name" />
					<input type="email" placeholder="Email" />
					<input type="text" placeholder="Phone Number" />
					<input type="text" placeholder="Country" />
					<input type="password" placeholder="Password" />
					<button>Submit</button>
				</div>
			</div>
		</div>

		<header>
			<div class="containers" id="header">
				<div class="logo">
					<img src="assets/IAML Logo-01.png" alt="" />
				</div>
				<div class="menu-toggle" onclick="toggleMenu()">
					<span></span>
					<span></span>
					<span></span>
				</div>
				<div class="links">
					<a href="about.html">About</a>
					<a href="services.html">Services</a>
					<a href="careers.html">Careers</a>
					<a href="e-trader.html">E-Trader</a>
					<a href="login.html" class="login">Login</a>
					<a href="#openAccounts" id="signup-link" class="register">Signup</a>
				</div>
			</div>
		</header>
		<script>
			function toggleMenu() {
				const links = document.querySelector(".links");
				links.classList.toggle("active");
			}
		</script>
		<script src="./fetch.js"></script>
		<div
			id="openAccounts"
			style="
				position: fixed;
				background: rgb(0, 0, 0, 0.3);
				top: 0;
				height: 100%;
				z-index: 99999;
				display: none;
				flex-direction: column;
				justify-content: center;
				align-items: center;
			"
		>
			<div class="git" style="position: relative">
				<span
					id="closeModal"
					style="
						font-size: 1rem;
						border: 1px solid rgb(51, 50, 50);
						padding: 0 10px;
						position: absolute;
						right: 0.5rem;
						top: 5px;
						cursor: pointer;
					"
					>x</span
				>
				<div class="faqtitle">Open an account with us</div>
				<div class="faqsubtitle">
					Imperial-trader, you can trade your securities online, in real time
					with as little as a minimum account opening balance of N5,000 only
					from wherever you are. We provide a comprehensive range of services to
					meet and execute on your investment requirements
				</div>

				<div class="btns">
					<button id="individual-account-btn">
						Open an Individual Account
					</button>
					<button id="corporate-account-btn">Open a Corporate Account</button>

					<script>
						const signupLink = document.getElementById("signup-link");
						const openAccounts = document.getElementById("openAccounts");
						const closeModal = document.getElementById("closeModal");

						signupLink.addEventListener("click", (e) => {
							e.preventDefault();
							openAccounts.style.display = "flex";
						});
						closeModal.addEventListener("click", () => {
							openAccounts.style.display = "none";
						});

						const individualAccountBtn = document.getElementById(
							"individual-account-btn"
						);
						const corporateAccountBtn = document.getElementById(
							"corporate-account-btn"
						);

						individualAccountBtn.addEventListener("click", () => {
							window.location.href = "etraderform.html";
						});
						corporateAccountBtn.addEventListener("click", () => {
							window.location.href = "ecorporateform.html";
						});
					</script>
				</div>
			</div>
		</div>
		<div class="ovl"></div>
		<main>
			<!-- <div class="containers etarderform">
        <br />
        <br />
        <h1>Individual account opening form</h1>
        <p>Personal Information</p>
        <div class="formprogress">
          <div class="progressdata">1 <span>/4</span></div>
        </div>
        <br />

        <div class="etraderformgrid">
          <div class="fblk">
            <input type="text" placeholder="Surname" />
          </div>
          <div class="fblk">
            <input type="text" placeholder="First Name" />
          </div>

          <div class="fblk">
            <input type="number" placeholder="Phone Number" />
            <input type="email" placeholder="Email Address" />
          </div>

          <div class="fblk">
            <input type="datetime-local" placeholder="Date Of Birth" />
            <select name="" id="">
              <option value="">Gender</option>
              <option value="">Male</option>
              <option value="">Female</option>
            </select>
          </div>

          <div class="fblk">
            <select name="" id="">
              <option value="">Nationality</option>
              <option value="">Nigeria</option>
              <option value="">Ghana</option>
            </select>
            <select name="" id="">
              <option value="">Marital Status</option>
              <option value="">Single</option>
              <option value="">Married</option>
            </select>
          </div>
          <div class="fblk">
            <input type="text" placeholder="Mothers Maiden Name" />
          </div>
          <div class="fblk">
            <input type="text" placeholder="Residential Address" />
          </div>

          <div class="fblk">
            <select name="" id="">
              <option value="">Country</option>
              <option value="">Nigeria</option>
              <option value="">Ghana</option>
            </select>
            <select name="" id="">
              <option value="">State</option>
              <option value="">Lagos</option>
              <option value="">Ibadan</option>
            </select>
          </div>

          <div class="fblk">
            <select name="" id="">
              <option value="">Means Of Identification</option>
              <option value="">NIN</option>
              <option value="">Drivers License</option>
            </select>
            <input type="text" placeholder="ID No." />
          </div>

          <div class="fblk">
            <div class="iconinput">
              <input type="file" placeholder="Upload Id" />
              <span
                ><span class="material-symbols-outlined"> backup </span></span
              >
            </div>
          </div>

          <div class="fblk">
            <div class="iconinput">
              <input type="file" placeholder="Upload Id" />
              <span
                ><span class="material-symbols-outlined"> backup </span></span
              >
            </div>
          </div>

          <div class="fblk">
            <div class="iconinput">
              <input
                type="file"
                title="Choose a video please"
                placeholder="Upload Id"
              />
              <span
                ><span class="material-symbols-outlined"> backup </span></span
              >
            </div>
          </div>

  
        </div>
                <div class="fblk etraderformgrid">
            <button>Next</button>
          </div>
      </div> -->
			<style>
				.fblk {
					flex-direction: column;
					gap: 2px;
				}

				.btnk {
					display: flex;
					flex-direction: row;
					gap: 10px;
				}
			</style>

			<div class="containers etarderform">
				<h1>Individual Account Opening Form</h1>
				<div class="formprogress">
					<div class="progressdata" id="progress-text">1 / 5</div>
				</div>

				<!-- Step 1: Personal Information -->
				<form id="multistep-form">
					<div class="step step-1">
						<h3>Step 1: Personal Information</h3>
						<div class="etraderformgrid">
							<div class="fblk">
								<label for="title">Title *</label>
								<select id="title" required>
									<option value="">Select Prefix</option>
									<option value="Mr">Mr</option>
									<option value="Mrs">Mrs</option>
									<option value="Miss">Miss</option>
									<option value="Dr">Dr</option>
								</select>
							</div>
							<div class="fblk">
								<label for="first-name">First Name *</label>
								<input
									type="text"
									id="first-name"
									placeholder="Enter First Name"
									required
								/>
							</div>
							<div class="fblk">
								<label for="middle-name">Middle Name *</label>
								<input
									type="text"
									id="middle-name"
									placeholder="Enter Middle Name"
									required
								/>
							</div>
							<div class="fblk">
								<label for="last-name">Last Name *</label>
								<input
									type="text"
									id="last-name"
									placeholder="Enter Last Name"
									required
								/>
							</div>
							<div class="fblk">
								<label for="email">Email Address *</label>
								<input
									type="email"
									id="email"
									placeholder="example@gmail.com"
									required
								/>
							</div>
							<div class="fblk">
								<label for="phone">Phone Number *</label>
								<input
									type="text"
									id="phone"
									placeholder="Enter Phone No"
									required
								/>
							</div>
							<div class="fblk">
								<label for="dob">Date of Birth *</label>
								<input type="date" id="dob" required />
							</div>
							<div class="fblk">
								<label for="marital-status">Marital Status *</label>
								<select id="marital-status" required>
									<option value="">Select Marital Status</option>
									<option value="Single">Single</option>
									<option value="Married">Married</option>
									<option value="Divorced">Divorced</option>
									<option value="Widowed">Widowed</option>
								</select>
							</div>
							<div class="fblk">
								<label for="nationality">Nationality *</label>
								<input
									type="text"
									id="nationality"
									placeholder="Select Nationality"
									required
								/>
							</div>
							<div class="fblk">
								<label for="country">Country *</label>
								<input
									type="text"
									id="country"
									placeholder="Select Country"
									required
								/>
							</div>
							<div class="fblk">
								<label for="gender">Gender *</label>
								<select id="gender" required>
									<option value="">Select Gender</option>
									<option value="Male">Male</option>
									<option value="Female">Female</option>
									<option value="Other">Other</option>
								</select>
							</div>
							<div class="fblk">
								<label for="religion">Religion *</label>
								<input
									type="text"
									id="religion"
									placeholder="Select Religion"
									required
								/>
							</div>
							<div class="fblk">
								<label for="mothers-name">Mother's Maiden Name *</label>
								<input
									type="text"
									id="mothers-name"
									placeholder="Enter Mother's Maiden Name"
									required
								/>
							</div>
							<div class="fblk">
								<label for="landmark">Nearest Landmark *</label>
								<input
									type="text"
									id="landmark"
									placeholder="Enter Nearest Landmark"
									required
								/>
							</div>
							<div class="fblk">
								<label for="state">State of Origin *</label>
								<input
									type="text"
									id="state"
									placeholder="Select State of Origin"
									required
								/>
							</div>
							<div class="fblk">
								<label for="lga">LGA of Residence *</label>
								<input type="text" id="lga" placeholder="Select LGA" required />
							</div>
							<div class="fblk">
								<label for="residential-address">Residential Address *</label>
								<input
									type="text"
									id="residential-address"
									placeholder="Enter Residential Address"
									required
								/>
							</div>
							<div class="fblk">
								<label for="id-type">ID Type *</label>
								<select id="id-type" required>
									<option value="">Select ID Type</option>
									<option value="NIN">NIN</option>
									<option value="Passport">Passport</option>
									<option value="Driver's License">Driver's License</option>
									<option value="Voter's Card">Voter's Card</option>
								</select>
							</div>
							<div class="fblk">
								<label for="id-number">ID Number *</label>
								<input
									type="text"
									id="id-number"
									placeholder="Enter ID Number"
									required
								/>
							</div>
						</div>
						<div class="fblk btnk etraderformgrid">
							<button type="button" onclick="nextStep(1)">Next</button>
						</div>
					</div>

					<!-- Step 2: Address Information -->
					<div class="step step-2 hidden">
						<h3>Step 2: Address Information</h3>
						<div class="etraderformgrid">
							<div class="fblk">
								<label for="office-address">Office Address</label>
								<input
									type="text"
									id="office-address"
									placeholder="Office Address"
									required
								/>
							</div>
							<div class="fblk">
								<label for="office-phone">Office Telephone</label>
								<input
									type="text"
									id="office-phone"
									placeholder="Office Telephone"
								/>
							</div>
							<div class="fblk">
								<label for="home-address">Home Address</label>
								<input
									type="text"
									id="home-address"
									placeholder="Home Address"
									required
								/>
							</div>
							<div class="fblk">
								<label for="home-phone">Home Telephone</label>
								<input
									type="text"
									id="home-phone"
									placeholder="Home Telephone"
								/>
							</div>
						</div>
						<div class="fblk btnk etraderformgrid">
							<button type="button" onclick="prevStep(2)" class="whitebtn">
								Previous
							</button>
							<button type="button" onclick="nextStep(2)">Next</button>
						</div>
					</div>

					<!-- Step 3: Employment & Income Details -->
					<div class="step step-3 hidden">
						<h3>Step 3: Employment & Income Details</h3>
						<div class="etraderformgrid">
							<div class="fblk">
								<label for="occupation">Occupation/Line of Business</label>
								<input
									type="text"
									id="occupation"
									placeholder="Occupation/Line of Business"
									required
								/>
							</div>
							<div class="fblk">
								<label for="job-title">Job Title</label>
								<input type="text" id="job-title" placeholder="Job Title" />
							</div>
							<div class="fblk">
								<label for="company-name">Company Name</label>
								<input
									type="text"
									id="company-name"
									placeholder="Company Name"
								/>
							</div>
							<div class="fblk">
								<label for="self-employed">Are you Self Employed?</label>
								<select id="self-employed">
									<option value="">Select</option>
									<option value="Yes">Yes</option>
									<option value="No">No</option>
								</select>
							</div>
							<div class="fblk">
								<label for="annual-income">Annual Income</label>
								<input
									type="text"
									id="annual-income"
									placeholder="Annual Income"
									required
								/>
							</div>
						</div>
						<div class="fblk btnk etraderformgrid">
							<button type="button" onclick="prevStep(3)" class="whitebtn">
								Previous
							</button>
							<button type="button" onclick="nextStep(3)">Next</button>
						</div>
					</div>

					<!-- Step 4: Additional Information -->
					<div class="step step-4 hidden">
						<h3>Step 4: Banking Information</h3>
						<div class="etraderformgrid">
							<div class="fblk">
								<label for="bank-name">Bank Name</label>
								<select id="bank-name" required>
									<option value="">Select Bank</option>
								</select>
							</div>
							<div class="fblk">
								<label for="account-number">Account Number</label>
								<input
									type="text"
									id="account-number"
									placeholder="Enter Account Number"
									required
								/>
							</div>
							<div class="fblk">
								<label for="account-name">Account Name</label>
								<input
									type="text"
									id="account-name"
									placeholder="Account Name"
									readonly
								/>
							</div>
							<div class="fblk">
								<label for="bvn">BVN</label>
								<input
									type="text"
									id="bvn"
									placeholder="bank Verification Number"
									required
								/>
							</div>
						</div>

						<script>
							const PAYSTACK_SECRET_KEY =
								"sk_test_9b7782e2e31d0c2156deed534c8a1e7a72a5c1ef"; // Replace with your actual Paystack secret key
							let typingTimer; // Timer for debounce
							const typingDelay = 500; // Delay in milliseconds

							// Function to populate the bank list
							async function fetchBankList() {
								try {
									const response = await fetch("https://api.paystack.co/bank", {
										method: "GET",
										headers: {
											Authorization: `Bearer ${PAYSTACK_SECRET_KEY}`,
											"Content-Type": "application/json",
										},
									});
									const { data } = await response.json();

									if (!data) throw new Error("No data returned from API");

									const bankNameSelect = document.getElementById("bank-name");
									data.forEach((bank) => {
										const option = document.createElement("option");
										option.value = bank.code;
										option.textContent = bank.name;
										bankNameSelect.appendChild(option);
									});
								} catch (error) {
									console.error("Error fetching bank list:", error);
									alert("Unable to fetch bank list. Please try again later.");
								}
							}

							// Function to fetch account name
							async function fetchAccountName() {
								const bankCode = document.getElementById("bank-name").value;
								const accountNumber =
									document.getElementById("account-number").value;

								// Validate inputs: Bank must be selected, and account number should be 11 digits
								if (!bankCode || accountNumber.length !== 10) {
									document.getElementById("account-name").value = ""; // Clear account name if validation fails
									return;
								}

								try {
									// Construct the URL with query parameters
									const url = `https://api.paystack.co/bank/resolve?account_number=${accountNumber}&bank_code=${bankCode}`;

									// Make the GET request
									const response = await fetch(url, {
										method: "GET",
										headers: {
											Authorization: `Bearer ${PAYSTACK_SECRET_KEY}`,
											"Content-Type": "application/json",
										},
									});

									const { data, status, message } = await response.json();
									if (status) {
										document.getElementById("account-name").value =
											data.account_name;
									} else {
										alert(message || "Could not resolve account name.");
										document.getElementById("account-name").value = ""; // Clear account name if response fails
									}
								} catch (error) {
									console.error("Error resolving account name:", error);
									alert("An error occurred while fetching account name.");
									document.getElementById("account-name").value = ""; // Clear account name if error occurs
								}
							}

							// Event Listener with Debounce for Account Number Input
							document
								.getElementById("account-number")
								.addEventListener("input", () => {
									clearTimeout(typingTimer); // Clear the previous timer
									typingTimer = setTimeout(fetchAccountName, typingDelay); // Set a new timer to wait before fetching
								});

							// Trigger fetch when bank is selected
							document
								.getElementById("bank-name")
								.addEventListener("change", fetchAccountName);

							// Initialize bank list on page load
							fetchBankList();
						</script>

						<div class="fblk btnk etraderformgrid">
							<button type="button" onclick="prevStep(4)" class="whitebtn">
								Previous
							</button>
							<button type="button" onclick="nextStep(4)">Next</button>
						</div>
					</div>

					<div class="step step-5 hidden">
						<h3>Step 4: Additional Information</h3>
						<div class="etraderformgrid">
							<div class="fblk">
								<label for="introduced-by"
									>Who introduced you to Imperial Asset Managers Limited?</label
								>
								<input
									type="text"
									id="introduced-by"
									placeholder="Introducer"
								/>
							</div>
							<div class="fblk">
								<label for="source-funds"
									>Source of Funds to Operate Account</label
								>
								<input
									type="text"
									id="source-funds"
									placeholder="Source of Funds"
									required
								/>
							</div>
							<div class="fblk">
								<label for="expected-amount">Amount (Expected Annual)</label>
								<input
									type="text"
									id="expected-amount"
									placeholder="Expected Annual Amount"
									required
								/>
							</div>
							<div class="fblk">
								<label for="other-income">Other Sources of Income</label>
								<input
									type="text"
									id="other-income"
									placeholder="Other Sources of Income"
								/>
							</div>
						</div>
						<div class="fblk btnk etraderformgrid">
							<button type="button" onclick="prevStep(5)" class="whitebtn">
								Previous
							</button>
							<button type="button" onclick="nextStep(5)">Submit</button>
						</div>
					</div>

					<div class="step step-6 hidden">
						<h3>Step 5: Upload Documents</h3>
						<br />
						<div class="etraderformgrid">
							<!-- Live Photo -->
							<div class="fblk">
								<label for="live-photo">Upload Recent Photo</label>
								<input
									type="file"
									id="live-photo"
									accept="image/*"
									capture="user"
									onchange="handleFileUpload('live-photo', 'live-photo-preview', 'live-photo-url')"
								/>
								<img
									id="live-photo-preview"
									class="preview-img hidden"
									alt="Live Photo Preview"
								/>
								<input
									type="hidden"
									id="live-photo-url"
									name="live-photo-url"
								/>
							</div>

							<!-- Utility Bill -->
							<div class="fblk">
								<label for="utility-bill">Upload Utility Bill</label>
								<input
									type="file"
									id="utility-bill"
									accept="image/*,application/pdf"
									onchange="handleFileUpload('utility-bill', 'utility-bill-preview', 'utility-bill-url')"
								/>
								<img
									id="utility-bill-preview"
									class="preview-img hidden"
									alt="Utility Bill Preview"
								/>
								<input
									type="hidden"
									id="utility-bill-url"
									name="utility-bill-url"
								/>
							</div>

							<!-- Proof of Identity -->
							<div class="fblk">
								<label for="proof-identity">Upload Proof of Identity</label>
								<input
									type="file"
									id="proof-identity"
									accept="image/*,application/pdf"
									onchange="handleFileUpload('proof-identity', 'proof-identity-preview', 'proof-identity-url')"
								/>
								<img
									id="proof-identity-preview"
									class="preview-img hidden"
									alt="Proof of Identity Preview"
								/>
								<input
									type="hidden"
									id="proof-identity-url"
									name="proof-identity-url"
								/>
							</div>
						</div>

						<!-- Navigation Buttons -->
						<div class="fblk btnk etraderformgrid">
							<button type="button" onclick="prevStep(6)" class="whitebtn">
								Previous
							</button>
							<button type="submit">Submit</button>
						</div>
					</div>

					<script>
						function handleFileUpload(inputId, previewId, hiddenInputId) {
							const fileInput = document.getElementById(inputId);
							const previewImage = document.getElementById(previewId);
							const hiddenInput = document.getElementById(hiddenInputId);

							if (fileInput.files.length === 0) {
								alert("Please select a file.");
								return;
							}

							const file = fileInput.files[0];
							const formData = new FormData();
							formData.append("user-file", file);

							// Display a preview for image files
							if (file.type.startsWith("image/")) {
								const reader = new FileReader();
								reader.onload = function (e) {
									previewImage.src = e.target.result;
									previewImage.classList.remove("hidden");
								};
								reader.readAsDataURL(file);
							}

							// Upload the file
							fetch("http://localhost:8000/upload.php", {
								method: "POST",
								body: formData,
							})
								.then((response) => response.json())
								.then((data) => {
									if (data.success) {
										alert("File uploaded successfully!");
										hiddenInput.value = data.fileUrl; // Set the file URL in the hidden input
									} else {
										alert("Upload failed: ");
										console.log(data);
									}
								})
								.catch((error) => {
									console.log(error);
									alert("An error occurred: ");
								});
						}
					</script>
				</form>
			</div>
			<style>
				.preview-img {
					display: block;
					margin-top: 10px;
					max-width: 100%;
					height: auto;
					max-height: 300px;
					border: 1px solid #ccc;
					border-radius: 5px;
					object-fit: cover;
				}
			</style>

			<style>
				.hidden {
					display: none;
				}
				.hidden {
					display: none;
				}
				.etraderformgrid .whitebtn {
					background-color: white;
					color: black !important;
				}
			</style>

			<script>
				const keycloakUrl = "https://sentry.issl.ng/auth";
				const realm = "Neos";
				const clientID = "candourcrestapp";
				const clientSecret = "f41ebbea-3719-4091-be8c-6929ffa529d8";
				const grantType = "password";
				const username = "candourcrest";
				const password = "ccapp";

				console.log({
					keycloakUrl,
					realm,
					clientID,
					clientSecret,
					grantType,
					username,
					password,
				});

				function setCookie(cname, cvalue, seconds) {
					const d = new Date();
					d.setTime(d.getTime() + seconds * 1000);
					let expires = "expires=" + d.toUTCString();
					document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
				}

				function getCookie(cname) {
					let name = cname + "=";
					let decodedCookie = decodeURIComponent(document.cookie);
					let ca = decodedCookie.split(";");
					for (let i = 0; i < ca.length; i++) {
						let c = ca[i];
						while (c.charAt(0) == " ") {
							c = c.substring(1);
						}
						if (c.indexOf(name) == 0) {
							return c.substring(name.length, c.length);
						}
					}
					return "";
				}

				// function checkCookie() {
				// 	let username = getCookie("username");
				// 	if (username != "") {
				// 		alert("Welcome again " + username);
				// 	} else {
				// 		username = prompt("Please enter your name:", "");
				// 		if (username != "" && username != null) {
				// 			setCookie("username", username, 365);
				// 		}
				// 	}
				// }

				// Fetch Access Token
				async function fetchAccessToken() {
					try {
						const urlencoded = new URLSearchParams({
							client_id: clientID,
							client_secret: clientSecret,
							grant_type: grantType,
							username: username,
							password: password,
						});

						const response = await fetch(
							`${keycloakUrl}/realms/${realm}/protocol/openid-connect/token`,
							{
								method: "POST",
								headers: {
									"Content-Type": "application/x-www-form-urlencoded",
								},

								body: urlencoded.toString(),
							}
						);

						if (!response.ok) {
							const errorData = await response.json();
							console.error("Error fetching access token:", errorData);
							throw new Error("Failed to fetch access token");
						}

						const data = await response.json();

						// Store the access_token and refresh_token in cookies
						setCookie("access_token", data.access_token, 120);
						setCookie("refresh_token", data.refresh_token, 180);

						console.log("Access token successfully fetched:", data);
						return data;
					} catch (error) {
						console.error("Error fetching access token:", error);
						throw error;
					}
				}

				// Refresh Access Token
				async function getNewAccessToken() {
					try {
						// const cookieStore = cookies();
						const storedRefreshToken = getCookie("refresh_token");

						if (!storedRefreshToken) {
							throw new Error("No refresh token found in cookies");
						}

						const urlencoded = new URLSearchParams({
							client_id: clientID,
							client_secret: clientSecret,
							grant_type: "refresh_token",
							refresh_token: storedRefreshToken,
						});

						const response = await fetch(
							`${keycloakUrl}/realms/${realm}/protocol/openid-connect/token`,
							{
								method: "POST",
								headers: {
									"Content-Type": "application/x-www-form-urlencoded",
								},
								body: urlencoded.toString(),
							}
						);

						if (!response.ok) {
							const errorData = await response.json();
							console.error("Error refreshing token:", errorData);
							throw new Error("Failed to refresh token");
						}

						const data = await response.json();

						// Update the cookies with new tokens

						setCookie("access_token", data.access_token, 120);
						setCookie("refresh_token", data.refresh_token, 180);
						// cookieStore.set("access_Token", data.access_token, {
						// 	httpOnly: true,
						// 	maxAge: 20 * 60,
						// 	sameSite: "Strict",
						// });

						// cookieStore.set("refresh_Token", data.refresh_token, {
						// 	httpOnly: true,
						// 	maxAge: 30 * 60,
						// 	sameSite: "Strict",
						// });

						return data.access_token;
					} catch (error) {
						console.error("Error refreshing access token:", error);
						throw error;
					}
				}

				// Fetch with Interceptor
				async function fetchWithInterceptor(url, options = {}) {
					try {
						let token = getCookie("access_token");
						const refreshToken = cookieStore.get("refresh_token");

						// If Access Token is Missing or Expired
						if (!token && refreshToken) {
							token = await getNewAccessToken();
						}

						const headers = {
							Authorization: `Bearer ${token}`,
							"Content-Type": "application/json",
							...options.headers,
						};

						const response = await fetch(url, {
							...options,
							headers,
						});

						// Handle Unauthorized Error (401)
						if (response.status === 401 && refreshToken) {
							const newToken = await getNewAccessToken();

							setCookie("access_token", newToken, 120);

							// cookieStore.set("access_token", newToken, {
							// 	httpOnly: true,
							// 	maxAge: 20 * 60,
							// 	sameSite: "Strict",
							// });

							// Retry the request with the new token
							headers.Authorization = `Bearer ${newToken}`;
							return fetch(url, {
								...options,
								headers,
							});
						}

						return response;
					} catch (error) {
						console.error("Error in fetchWithInterceptor:", error);
						throw error;
					}
				}

				let currentStep = 1;
				const totalSteps = 6;
				const steps = document.querySelectorAll(".step");
				const progressText = document.getElementById("progress-text");

				function showStep(step) {
					steps.forEach((el, index) => {
						el.classList.toggle("hidden", index + 1 !== step);
					});
					progressText.textContent = `${step} / ${totalSteps}`;
				}

				function validateStep(step) {
					const stepFields = document.querySelectorAll(
						`.step:nth-child(${step}) input, .step:nth-child(${step}) select`
					);
					let isValid = true;

					stepFields.forEach((field) => {
						if (!field.value.trim()) {
							isValid = false;
							field.classList.add("error"); // Highlight the empty fields
						} else {
							field.classList.remove("error");
						}
					});

					if (!isValid) {
						alert(
							"Please fill all required fields before proceeding to the next step."
						);
					}

					return isValid;
				}

				function nextStep() {
					if (currentStep < totalSteps && validateStep(currentStep)) {
						currentStep++;
						showStep(currentStep);
					}
				}

				function prevStep() {
					if (currentStep > 1) {
						currentStep--;
						showStep(currentStep);
					}
				}

				// Submission of form data
				document.getElementById("multistep-form").onsubmit = async function (
					e
				) {
					e.preventDefault();

					const requiredFields = [
						"live-photo-url",
						"utility-bill-url",
						"proof-identity-url",
					];
					const formData = {};

					// Check for missing file uploads
					let missingFields = [];
					requiredFields.forEach((field) => {
						const value = document.getElementById(field).value;
						if (!value) {
							missingFields.push(field.replace("-url", "").replace(/-/g, " ")); // Format the field name
						} else {
							formData[field] = value; // Add only the URLs to formData
						}
					});

					// If any required file is missing, show an error
					if (missingFields.length > 0) {
						alert(
							`Please upload the following file(s): ${missingFields.join(", ")}`
						);
						return;
					}

					// Include other form inputs (excluding file inputs)
					const inputs = document.querySelectorAll(
						"#multistep-form input:not([type='file']), #multistep-form select"
					);
					inputs.forEach((input) => {
						formData[input.id] = input.value;
					});

					// Prepare data for ISSL API (modify structure if needed)
					const isslData = {
						customerType: "I",
						customerCategory: "I",
						bankAccountName: formData["account-name"],
						bankAccountNo: formData["account-number"],
						grossAnnualIncome: formData["annual-income"],
						bankName: formData["bank-name"],
						bvn: formData["bvn"],
						employerName: formData["company-name"],
						country: formData["country"],
						dob: formData["dob"],
						email: formData["email"],
						marketShare: formData["expected-amount"],
						firstName: formData["first-name"],
						gender: formData["gender"],
						address: formData["home-address"],
						phoneRef: formData["home-phone"],
						nin: formData["id-number"],
						id: formData["id-type"],
						altRelationshipMan: formData["introduced-by"],
						profession: formData["job-title"],
						nearestBusStop: formData["landmark"],
						lastName: formData["last-name"],
						lgaOfResidence: formData["lga"],
						url: formData["live-photo-url"],
						kycdocs: [
							{
								documentType: "passport",
								image: formData["proof-identity-url"],
							},
							{
								documentType: "utility",
								image: formData["utility-bill-url"],
							},
						],
						maritalStatus: formData["marital-status"],
						otherName: formData["middle-name"],
						mothersMaidenName: formData["mothers-name"],
						nationality: formData["nationality"],
						natureofEmployment: formData["occupation"],
						employerAddress: formData["office-address"],
						officePhoneNo: formData["office-phone"],
						notes: formData["other-income"],
						religion: formData["religion"],
						address2: formData["residential-address"],
						employmentStatus: formData["self-employed"],
						occupationDesc: formData["source-funds"],
						state: formData["state"],
						title: formData["title"],
					};

					console.table(isslData);
					const access_token = await fetchAccessToken();
					console.log(access_token);

					// Send data to ISSL API
					try {
						const response = await fetchWithInterceptor(
							"http://api.issl.ng:7777/onboarding-api/1.0/newcustomer2/1/${data.firstName}/${data.lastName}",
							{
								method: "POST",
								headers: {
									"Content-Type": "application/json",
									access_token,
								},
								body: JSON.stringify(formData),
							}
						);
						const result = await response.json();
						if (res.status === 200) {
							console.log(result);
							return result;
						} else {
							console.log("didn't upload successfully");
						}
					} catch (error) {
						console.log("Error: " + error.message);
					}
				};

				// Initial step setup
				showStep(currentStep);
			</script>

			<!-- <script>
        let currentStep = 1;
        const totalSteps = 6;
        const steps = document.querySelectorAll(".step");
        const progressText = document.getElementById("progress-text");

        function showStep(step) {
          steps.forEach((el, index) => {
            el.classList.toggle("hidden", index + 1 !== step);
          });
          progressText.textContent = `${step} / ${totalSteps}`;
        }

        function validateStep(step) {
          const stepFields = document.querySelectorAll(
            `.step:nth-child(${step}) input, .step:nth-child(${step}) select`
          );
          let isValid = true;

          stepFields.forEach((field) => {
            if (!field.value.trim()) {
              isValid = false;
              field.classList.add("error");
            } else {
              field.classList.remove("error");
            }
          });

          if (!isValid) {
            alert("Please fill all required fields before proceeding.");
          }

          return isValid;
        }

        function nextStep() {
          if (currentStep < totalSteps && validateStep(currentStep)) {
            currentStep++;
            showStep(currentStep);
          }
        }

        function prevStep() {
          if (currentStep > 1) {
            currentStep--;
            showStep(currentStep);
          }
        }

        async function submitToMarketReportsAPI(formData) {
          try {
            console.log("Submitting to Market Reports API:", formData);
            const response = await fetch(
              "https://marketreports.vercel.app/api/form-submission/",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(formData),
              }
            );

            const result = await response.json();
            if (result.status === "success") {
              console.log("Market Reports API submission successful!");
              return { success: true, message: "Form submitted successfully!" };
            } else {
              console.error("Market Reports API error:", result.message);
              return { success: false, message: result.message };
            }
          } catch (error) {
            console.error("Error submitting to Market Reports API:", error);
            return {
              success: false,
              message: "An error occurred while submitting.",
            };
          }
        }

        async function submitToISSLAPI(data) {
          try {
            console.log("Submitting to ISSL API:", data);
            const storedAccessToken = localStorage.getItem("access_token");
            const response = await fetch(
              // `http://api.issl.ng:7777/onboarding-api/1.0/newcustomer2/1/${data.firstName}/${data.lastName}`,
              `https://api.issl.ng/onboarding-api/1.0/newcustomer2/1/${data.first-Name}/${data.lastName}`,
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  "X-Tenantid": "greshamuat",
                  // "X-Tenantid": "demo",
                  // access_token: storedAccessToken,
                },
                body: JSON.stringify(data),
              }
            );

            const result = await response.json();
            if (response.status === 200) {
              console.log("ISSL API submission successful!", result);
              return {
                success: true,
                message: "Customer created successfully!",
              };
            } else {
              console.error("ISSL API submission failed.");
              return {
                success: false,
                message: "Failed to submit to ISSL API.",
              };
            }
          } catch (error) {
            console.error("Error submitting to ISSL API:", error);
            return {
              success: false,
              message: "An error occurred while submitting.",
            };
          }
        }

        document.getElementById("multistep-form").onsubmit = async function (
          e
        ) {
          e.preventDefault();

          // Collect required files
          const requiredFields = [
            "live-photo-url",
            "utility-bill-url",
            "proof-identity-url",
          ];
          const formData = {};
          let missingFields = [];

          requiredFields.forEach((field) => {
            const value = document.getElementById(field).value;
            if (!value) {
              missingFields.push(field.replace("-url", "").replace(/-/g, " "));
            } else {
              formData[field] = value;
            }
          });

          if (missingFields.length > 0) {
            alert(`Please upload: ${missingFields.join(", ")}`);
            return;
          }

          // Collect other form data
          const inputs = document.querySelectorAll(
            "#multistep-form input:not([type='file']), #multistep-form select"
          );
          inputs.forEach((input) => {
            formData[input.id] = input.value;
          });

          console.log("Form data collected:", formData);

          // Prepare data for ISSL API (modify structure if needed)
          const isslData = {
            customerType: "I",
            customerCategory: "I",
            bankAccountName: formData["account-name"],
            bankAccountNo: formData["account-number"],
            grossAnnualIncome: formData["annual-income"],
            bankName: formData["bank-name"],
            bvn: formData["bvn"],
            employerName: formData["company-name"],
            country: formData["country"],
            dob: formData["dob"],
            email: formData["email"],
            marketShare: formData["expected-amount"],
            firstName: formData["first-name"],
            gender: formData["gender"],
            address: formData["home-address"],
            phoneRef: formData["home-phone"],
            nin: formData["id-number"],
            id: formData["id-type"],
            altRelationshipMan: formData["introduced-by"],
            profession: formData["job-title"],
            nearestBusStop: formData["landmark"],
            lastName: formData["last-name"],
            lgaOfResidence: formData["lga"],
            url: formData["live-photo-url"],
            kycdocs: [
              {
                documentType: "passport",
                image: formData["proof-identity-url"],
              },
              {
                documentType: "utility",
                image: formData["utility-bill-url"],
              },
            ],
            maritalStatus: formData["marital-status"],
            otherName: formData["middle-name"],
            mothersMaidenName: formData["mothers-name"],
            nationality: formData["nationality"],
            natureofEmployment: formData["occupation"],
            employerAddress: formData["office-address"],
            officePhoneNo: formData["office-phone"],
            notes: formData["other-income"],
            religion: formData["religion"],
            address2: formData["residential-address"],
            employmentStatus: formData["self-employed"],
            occupationDesc: formData["source-funds"],
            state: formData["state"],
            title: formData["title"],
          };

          // Submit data to both APIs
          const [marketReportsResult, isslResult] = await Promise.all([
            submitToMarketReportsAPI(formData),
            submitToISSLAPI(isslData),
          ]);

          // Handle response messages
          if (marketReportsResult.success && isslResult.success) {
            window.location.href = "/";
          } else {
            alert(
              `Submission Errors:\n${marketReportsResult.message}\n${isslResult.message}`
            );
          }
        };

        showStep(currentStep);
      </script> -->

			<!-- <script>
        let currentStep = 1;
        const totalSteps = 6;
        const steps = document.querySelectorAll(".step");
        const progressText = document.getElementById("progress-text");

        function showStep(step) {
          steps.forEach((el, index) => {
            el.classList.toggle("hidden", index + 1 !== step);
          });
          progressText.textContent = `${step} / ${totalSteps}`;
        }

        function validateStep(step) {
          const stepFields = document.querySelectorAll(
            `.step:nth-child(${step}) input, .step:nth-child(${step}) select`
          );
          let isValid = true;

          stepFields.forEach((field) => {
            if (!field.value.trim()) {
              isValid = false;
              field.classList.add("error"); // Highlight the empty fields
            } else {
              field.classList.remove("error");
            }
          });

          if (!isValid) {
            alert(
              "Please fill all required fields before proceeding to the next step."
            );
          }

          return isValid;
        }

        function nextStep() {
          if (currentStep < totalSteps && validateStep(currentStep)) {
            currentStep++;
            showStep(currentStep);
          }
        }

        function prevStep() {
          if (currentStep > 1) {
            currentStep--;
            showStep(currentStep);
          }
        }

        document.getElementById("multistep-form").onsubmit = async function (
          e
        ) {
          e.preventDefault();

          const requiredFields = [
            "live-photo-url",
            "utility-bill-url",
            "proof-identity-url",
          ];
          const formData = {};

          // Check for missing file uploads
          let missingFields = [];
          requiredFields.forEach((field) => {
            const value = document.getElementById(field).value;
            if (!value) {
              missingFields.push(field.replace("-url", "").replace(/-/g, " ")); // Format the field name
            } else {
              formData[field] = value; // Add only the URLs to formData
            }
          });

          // If any required file is missing, show an error
          if (missingFields.length > 0) {
            alert(
              `Please upload the following file(s): ${missingFields.join(", ")}`
            );
            return;
          }

          // Include other form inputs (excluding file inputs)
          const inputs = document.querySelectorAll(
            "#multistep-form input:not([type='file']), #multistep-form select"
          );
          inputs.forEach((input) => {
            formData[input.id] = input.value;
          });

          // Send data to PHP endpoint
          try {
            console.log(formData);
            const response = await fetch(
              "https://marketreports.vercel.app/api/form-submission/",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(formData),
              }
            );

            const result = await response.json();
            if (result.status === "success") {
              alert("Form submitted successfully!");
              window.location.href = "/";
            } else {
              alert("Error: " + result.message);
            }
          } catch (error) {
            console.error("Error submitting form:", error);
            alert("An error occurred while submitting the form.");
          }
        };

        // Initial step setup
        showStep(currentStep);

      
          console.log("total");
          const sendFormData = async () => {
            try {
              const res = await fetch(
                `https://api.issl.ng/onboarding-api/1.0/newcustomer2/1/${data.firstName}/${data.lastName}`,
                {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                    "X-Tenantid": "demo",
                  },
                  body: JSON.stringify(sendableData),
                }
              );

              const result = await res.json();
              if (res.status === 200) {
                console.log(result);
                return result;
              } else {
                console.log("didn't upload successfully");
              }
            } catch (error) {
              console.log("Error: " + error.message);
            } finally {
            }
          };
            if (currentStep === totalSteps) {
          sendFormData();
        }
      </script> -->

			<script></script>
		</main>

		<footer>
			<div class="containers">
				<div class="footersec">
					<div class="footertop">Explore</div>
					<div class="footerbtm">
						<a href="about.html"> About </a>
						<a href="services.html"> Board of Directors </a>
						<a href="services.html"> Management </a>
						<a href="careers.html"> Careers </a>
					</div>
				</div>

				<div class="footersec">
					<div class="footertop">Our Businesses</div>
					<div class="footerbtm">
						<a href="iaml.html">Imperial Asset Managers Limited</a>
						<a href="ical.html">Imperial Capital Advisers Limited</a>
					</div>
				</div>

				<div class="footersec">
					<div class="footertop">Our Newsfeed</div>
					<div class="footerbtm">
						<a href=""> All News</a>
						<a href="research.html">Research and Insights</a>
						<a href="">Blog</a>
						<a href="policy.html">Policies</a>
						<a
							href="RISK-DISCLOSURE-STATEMENT.pdf"
							target="_blank"
							rel="noopener noreferrer"
							>Risk Disclosure Statement</a
						>
					</div>
				</div>

				<div class="footersec">
					<div class="footertop">Subscribe to our newsletter</div>
					<div class="footerbtm">
						Weekly email about trends shaping markets, industries and the global
						economy.
					</div>
					<input type="text" class="footerinput" />
					<button>Submit</button>
				</div>

				<div class="footersec">
					<div class="marg">
						<h6 class="footertop" style="font-size: 16px; margin-bottom: 8px">
							IMP Office Address
						</h6>
						<div class="footerbtm">
							<!-- <a href=""><b>Lagos Office:</b></a> -->
							<a href=""
								>THE IMPERIAL PLACE <br />
								24A, Mainland Way <br />
								Dolphin Estate, <br />
								Ikoyi, Lagos.</a
							>
						</div>
					</div>
					<div>
						<h6 class="footertop" style="font-size: 16px; margin-bottom: 8px">
							ICAL Office Address
						</h6>
						<div class="footerbtm">
							<!-- <a href=""><b>Lagos Office:</b></a> -->
							<a href=""
								>THE EBENEZER PLACE <br />
								148A, Ikeja Way <br />
								Off Association Road <br />
								Dolphin Estate, <br />
								Ikoyi, Lagos.</a
							>
						</div>
					</div>
				</div>
				<div class="footersec map">
					<iframe
						src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3964.5036533682055!2d3.4132098740454926!3d6.457688223926582!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x103b8b35b4fdc5a5%3A0x59082e1e16d38ed5!2s24%20Mainland%20Way%2C%20Dolphine%20Estate%2C%20Lagos%20106104%2C%20Lagos!5e0!3m2!1sen!2sng!4v1736887923932!5m2!1sen!2sng"
						width="100%"
						height="100%"
						loading="lazy"
						title="Imperial asset"
						style="border: none; margin-bottom: 20px"
						referrerpolicy="no-referrer-when-downgrade"
					>
					</iframe>
					<iframe
						src="https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d15857.979123387264!2d3.4184!3d6.458821!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x238182d4bcfe0325!2sImperial+Asset+Managers+Limited!5e0!3m2!1sen!2sng!4v1550768151695"
						width="100%"
						height="100%"
						loading="lazy"
						title="Imperial asset"
						style="border: none"
					>
					</iframe>
				</div>

				<div class="footersec">
					<div class="footertop">Reach Us</div>
					<div class="footerbtm">
						<!-- <a href=""><b>Send a Message</b></a> -->

						<div class="reach">
							<div>
								<span
									><img
										src="./assets/envelope-solid.svg"
										alt="email address"
									/><span class="sp">IMP Email</span></span
								>
								<span
									><img
										style="visibility: hidden"
										src="./assets/envelope-solid.svg"
										alt="email address"
									/>
									<a class="no-copy" href="#">talk2us@imperialasset.com.ng</a>
								</span>
							</div>
							<div>
								<span
									><img
										src="./assets/envelope-solid.svg"
										alt="email address"
									/><span class="sp">ICAL Email</span></span
								>
								<span
									><img
										style="visibility: hidden"
										src="./assets/envelope-solid.svg"
										alt="email address"
									/>
									<a class="no-copy" href="#"
										>talk2capitaladvisers@imperial<br />asset.com.ng</a
									>
								</span>
							</div>
							<span
								><img src="./assets/phone-solid.svg" alt="phone" />234-706 043
								5102
							</span>
							<span
								><img src="./assets/phone-solid.svg" alt="phone" />234-806 703
								5949</span
							>
							<span
								><img src="./assets/phone-solid.svg" alt="phone" />234-912 500
								7249</span
							>

							<style>
								.no-copy {
									user-select: none;
									-webkit-user-select: none;
									-moz-user-select: none;
									-ms-user-select: none;
								}
								.reach {
									display: flex;
									flex-direction: column;
									gap: 5px;
								}
								.reach span {
									display: flex;
									align-items: center;
									gap: 8px;
								}
								.reach img {
									width: 15px;
								}
								.reach .sp {
									font-weight: 500;
									color: white;
								}
								.reach div {
									line-height: 20px;
									margin-bottom: 10px;
								}
							</style>
						</div>
					</div>
				</div>
				<div class="footersec">
					<img src="assets/COMP.png" alt="" />
				</div>
			</div>
		</footer>

		<script></script>
	</body>
</html>
